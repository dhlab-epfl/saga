function nl2p(t){return(t+"").replace(/([^>\r\n]+)(\r\n|\n\r|\r|\n)/g,"<p>$1</p>")}function showInfoBox(t,e){$("#infoMask").hide();var n=$('<div id="infoBox"/>').html('<img src="/i/loading.gif" />'),o=$('<div id="infoMask"/>').append(n).hide(100);o.bind("click touchdown",function(){$(this).fadeOut()}),$("body").append(o),o.fadeIn(100),$.get("_.php",{f:"getInfo",k:t},function(t){n.html(t)})}function orientationChange(){$.waypoints("refresh")}function showChapter(t,e){t.removeClass("loading"),$(".text>p").waypoint("destroy"),t.children("h1").html("T. "+e.tome),t.children("h2").html("ยง "+e.chapter);var n=nl2p(e.text+"\n")+kNextChapterSpacer;t.children(".text").html(n),0==e.more?t.children(".text").find(".spacer").addClass("last"):t.children(".text").find(".spacer .next").bind("click touchdown",function(){$("body,html").animate({scrollTop:$(this).offset().top+$(this).closest(".spacer").height()})}),Hyphenator.run(),t.children(".text").find(">p:not(.spacer)").waypoint(function(){$(this).addClass("read")},{offset:"100%",triggerOnce:!0}),t.children(".text").find("a.nomenclature").bind("click touchdown",function(t){t.preventDefault(),t.stopPropagation(),showInfoBox($(this).attr("data-word"),$(this))}),t.children(".text").find(">p.spacer:not(.last)").css({height:$.waypoints("viewportHeight")}).waypoint(function(){$(this).addClass("read"),loadNextChapter(),$(this).waypoint("destroy")}),$.waypoints("refresh"),$(".text p:in-viewport").addClass("read").css({opacity:"1"})}function loadNextChapter(){var t=$("#flow>div.page"),e=t.find("article").last();""!==$.trim(e.text())&&(e=e.clone(),e.children("*").html(""),t.find(".spacer .next").remove(),t.append(e)),e.addClass("loading"),window.scrollTo(0,document.body.scrollHeight),$.getJSON("_.php",{f:"getNextChapter"},function(t){setTimeout(function(){showChapter(e,t)},500)})}var kMinArticleHeight=300,kNextChapterSpacer='<p class="spacer"><a class="back" href="/library.php">Choisir un autre livre</a><a class="next">Chapitre suivant</a></p>';$(window).ready(function(){$("#flow").length&&(Hyphenator.config({displaytogglebox:!1}),loadNextChapter()),$("#bInfo").length>0&&$("#bInfo").click(function(){$("#about").fadeToggle(),$("#bInfo").toggleClass("active")}),$(".ui.sticky").sticky({context:"#wrapper"}),window.addEventListener("orientationchange",orientationChange),orientationChange(),document.body.style.webkitTouchCallout="none",document.body.style.KhtmlUserSelect="none"});